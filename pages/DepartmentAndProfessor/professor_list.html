<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>专家列表</title>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <link
      rel="stylesheet"
      href="../../Scripts/layui/css/layui.css"
      media="all"
    />
    <script
      src="../../Scripts/JsAndCss.Model.js"
      type="text/javascript"
    ></script>
    <!-- <script type="text/javascript" src="../../Scripts/jquery-3.3.1.min.js"></script>
    <script src="../../Scripts/layui/layui.js" charset="utf-8"></script>
    <script src="../../Scripts/layui/layui.all.js" charset="utf-8"></script> -->
    <script type="text/javascript" src="../../Scripts/local.js"></script>
  </head>

  <body>
    <div class="container">
      <div class="left">
        <ul id="deptShu"></ul>
      </div>
      <div class="right">
        <div id="toolBar">
          <table style="width: 100%;">
            <tr>
              <td>
                <form id="SearchForm">
                  <table style="width: 100%;">
                    <div class="myRow">
                      <div style="float: left;">
                        <label class="tb_1 layui-form-label">专家名称:</label>
                        <div class="layui-input-block">
                          <input
                            id="professorNameVague"
                            type="text"
                            name="professorNameVague"
                            placeholder="请输入"
                            class="layui-input"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div style="float: left;">
                        <label class="tb_1 layui-form-label">所属医院:</label>
                        <div class="layui-input-block">
                          <input
                            id="professorHosVague"
                            type="text"
                            name="professorHosVague"
                            placeholder="请输入"
                            class="layui-input"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <input
                        id="departmentGuid"
                        type="text"
                        name="departmentGuid"
                        autocomplete="off"
                        hidden
                      />
                      <input
                        id="departmentName"
                        type="text"
                        name="departmentName"
                        autocomplete="off"
                        hidden
                      />

                      <div class="tb_1" style="width: 100%;"></div>
                    </div>

                    <tr>
                      <td style="padding: 5px; width: 20%;">
                        <input
                          type="button"
                          value="查询"
                          onclick="search()"
                          class="layui-btn layui-btn-sm"
                        />

                        <input
                          type="button"
                          value="新增"
                          onclick="addRow()"
                          class="layui-btn layui-btn-sm"
                        />
                        <input
                          type="button"
                          value="删除"
                          onclick="deleteRow()"
                          class="layui-btn layui-btn-sm"
                        />
                      </td>
                    </tr>
                  </table>
                </form>
              </td>
            </tr>
          </table>
        </div>
        <table id="sechosProfessorTable"></table>
      </div>
      
    </div>

    <script>
      var table;
      var tree;
      layui.use(["table", "laydate", "tree", "util"], function () {
        table = layui.table;
        tree = layui.tree;
        var $ = layui.jquery;
        $.ajax({
          url: prUrl + "/sys/sechosdepartment/getDepartmentList",
          method: "get",
          dataType: "JSON",
          success: function (res) {
            if (res.code == "0") {
              layui.tree({
                elem: "#deptShu",
                nodes: [
                  {
                    //节点数据
                    name: "根目录",
                    children: res.data,
                  },
                ],
                click: function (node) {
                  if (node.rowGuid == undefined) {
                    node.rowGuid = "";
                  }
                  $("#departmentName").val(node.name);
                  $("#departmentGuid").val(node.rowGuid);
                  //console.log(node); //node即为当前点击的节点数据
                  initData({
                    departmentGuid: node.rowGuid,
                  });
                  // layui.table.reload("testReload", {
                  //   where: {
                  //     departmentGuid: node.rowGuid,
                  //   },
                  // });
                },
              });
            } else alert(res.msg);
          },
          error: function (jqXHR, textStatus, errorThrown) {},
        });
        search();
      });

      function initData(where) {
        //var m_url = location.protocol + '\\\\' + location.hostname + ':' + (location.port == '' ? 80 : location.port);
        table.render({
          id: "layuiTable", //固定写法
          elem: "#sechosProfessorTable", //固定写法
          height: "full-" + $("#toolBar").height(), //固定写法
          method: "get", //固定写法
          remoteSort: true,
          initSort: { field: "sortSq", type: "desc" },
          url: m_url + "/sys/sechosprofessor/listData", //数据接口
          page: true, //开启分页
          limit: 20, //每页显示行数
          where: where,
          cols: [
            [
              { type: "checkbox", fixed: "left" }, //固定
              {
                field: "professorName",
                title: "专家姓名",
                width: 200,
                align: "center",
              },
              {
                field: "professorTitle",
                title: "专家职称",
                width: 250,
                align: "center",
              },
              {
                field: "professorHos",
                title: "所属医院",
                width: 200,
                align: "center",
              },
              {
                field: "sortSq",
                title: "排序号",
                sort: true,
                width: 150,
                align: "center",
              },
              {
                title: "操作",
                align: "center",
                width: 80,
                // fixed: "right",
                templet: function (d) {
                  return (
                    "<a href=\"javascript: OpenWin('/SecHosBack/pages/DepartmentAndProfessor/professor_edit.html?rowGuid=" +
                    d.rowGuid +
                    "', 850, 500, '修改专家信息',refreshGrid)\" >修改</a>"
                  );
                },
              },
            ],
          ],
        });
      }

      function deleteRow() {
        var rows = table.checkStatus("layuiTable").data; //获取选中行
        if (!rows || rows.length == 0) {
          top.layuiMsg("请选择要删除的记录!");
          return;
        }
        top.layuiConfirm("确定要删除该记录?", {}, function () {
          var RowGuids = new Array();
          for (var i = 0; i < rows.length; i++) {
            RowGuids.push(rows[i].rowGuid);
          }

          SendAjax(
            "/sys/sechosprofessor/delete",
            JSON.stringify(RowGuids),
            function (res) {
              if (res.code == "0") {
                top.messageAlert("提醒", "删除成功", "info", function () {
                  refreshGrid();
                });
              } else {
                top.messageAlert("提醒", res.msg, "error");
              }
            }
          );
          return false;
        });
      }

      function refreshGrid() {
        table.reload("layuiTable");
      }

      function search() {
        var data = $("#SearchForm").serializeJson();
        initData(data);
      }

      function addRow() {
        OpenWin(
          "/SecHosBack/pages/DepartmentAndProfessor/professor_add.html?departmentName=" +
            $("#departmentName").val() +
            "&departmentGuid=" +
            $("#departmentGuid").val(),
          850,
          500,
          "新增专家",
          refreshGrid
        );
      }
    </script>
  </body>
</html>

<style>
  .layui-table-box {
    width: 100%;
  }

  .layui-table-body {
    overflow-x: hidden;
  }

  .icon {
    background-position: right;
    background-repeat: no-repeat;
    background-image: url("../../Scripts/layui/css/modules/laydate/icon.png");
  }

  .layui-btn {
    font-size: 14px;
    background-color: #3398e5;
    color: #fff;
    white-space: nowrap;
    text-align: center;
    font-size: 14px;
    border: none;
    border-radius: 2px;
    cursor: pointer;
    opacity: 0.9;
    width: 70px;
    height: 30px;
    line-height: 30px;
    padding: 0 10px;
    font-size: 13px;
    margin-left: 10px;
  }

  .layui-btn-normal {
    margin-left: 10px;
  }

  .layui-btn + .layui-btn {
    margin-left: 10px;
  }

  .myRow {
    display: flex;
    background-color: #f8f8f8;
    height: 43px;
  }

  .tb_1 {
    font-size: 14px;
    border-right: #e7e7e7 1px solid;
    border-top: #e7e7e7 1px solid;
    border-left: #e7e7e7 1px solid;
    border-bottom: #e7e7e7 1px solid;
    background-color: #f8f8f8;
    color: #28495c;
    height: 40px;
    float: left;
  }

  .layui-input-block,
  .layui-input-inline {
    position: inherit;
  }

  .layui-form-label {
    float: left;
    display: block;
    width: 80px;
    font-weight: 400;
    text-align: right;
    line-height: 40px;
    padding-right: 22px;
    padding-left: 5px;
    padding-top: 0px;
    padding-bottom: 0px;
  }

  .container {
    overflow: auto;
    display: flex;
    /*设为伸缩容器*/
    height: 100%;
  }

  .left {
    flex-shrink: 0;
    width: 200px;
    /*border: 2px solid blue;*/
  }

  .right {
    border: 2px solid #c2c2c2;
    flex: 1;
    /*这里设置为占比1，填充满剩余空间*/
  }

  .layui-inline {
    position: relative;
    display: inline-block;
    margin-right: 5px;
    /* bottom: -40px;*/
  }

  .layui-input,
  .layui-textarea {
    display: block;
    width: 200px;
    padding-left: 10px;
    margin-right: 2px;
    height: 42px;
    font-size: 14px;
  }

  .layui-input-block {
    margin-left: 110px;
  }

  .layui-form-label-1 {
    text-align: center;
    float: left;
    display: block;
    width: 4px;
    font-weight: 400;
    line-height: 40px;
    padding-right: 22px;
    padding-left: 10px;
    padding-top: 0px;
    padding-bottom: 0px;
    margin-left: 0px;
    margin-right: 0px;
  }
</style>
